cmake_minimum_required(VERSION 2.8.4)
include(ExternalProject)
if (NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE Release)
endif()

ExternalProject_Add(
    llvm
    SOURCE_DIR llvm
    GIT_REPOSITORY http://llvm.org/git/llvm.git
    GIT_TAG origin/master
    BINARY_DIR llvm_build
    CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${CMAKE_CURRENT_BINARY_DIR}/clang_install -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
    )

ExternalProject_Add(
    clang
    SOURCE_DIR ./clang
    GIT_REPOSITORY http://llvm.org/git/clang.git
    GIT_TAG origin/master
    BINARY_DIR clang_build
    CMAKE_ARGS -DCLANG_PATH_TO_LLVM_BUILD=../llvm_build -DCLANG_PATH_TO_LLVM_SOURCE=../llvm -DCMAKE_INSTALL_PREFIX=${CMAKE_CURRENT_BINARY_DIR}/clang_install -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
    DEPENDS llvm
    )

ExternalProject_Add(
    leveldb
    SOURCE_DIR ./leveldb
    GIT_REPOSITORY "https://code.google.com/p/leveldb/"
    GIT_TAG "85584d497e7b354853b72f450683d59fcf6b9c5c"
    CONFIGURE_COMMAND ""
    BUILD_COMMAND ""
    INSTALL_COMMAND ""
    UPDATE_COMMAND ""
    )
ExternalProject_Add(
    rct
    SOURCE_DIR ./rct
    CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${CMAKE_CURRENT_BINARY_DIR}/rct_install
    GIT_REPOSITORY git@github.com:Andersbakken/rct.git
    GIT_TAG "origin/master"
)
ExternalProject_Add(
    v8
    SOURCE_DIR ./v8
    CONFIGURE_COMMAND \$\(MAKE\) dependencies
    BINARY_DIR ./v8
    BUILD_COMMAND \$\(MAKE\) native
    INSTALL_COMMAND ""
    GIT_REPOSITORY git://github.com/v8/v8.git
    GIT_TAG "origin/master"
)
ExternalProject_Add(
    esprima
    SOURCE_DIR ./esprima
    CONFIGURE_COMMAND ""
    BUILD_COMMAND ""
    INSTALL_COMMAND ""
    GIT_REPOSITORY git://github.com/ariya/esprima.git
    GIT_TAG "origin/master"
)

add_custom_target (
    leveldb_make
    ALL
    COMMAND \$\(MAKE\)
    WORKING_DIRECTORY ./leveldb
    DEPENDS leveldb
    )

add_custom_target (
    leveldb_pull
    COMMAND git pull
    WORKING_DIRECTORY ./leveldb
    DEPENDS leveldb
    )

